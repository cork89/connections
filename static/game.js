"use strict";import{isErrorWithProperty as i}from"./common.js";const l=document.getElementsByClassName("word");var d=[],s=new Set,q="";const f=document.getElementById("board")??(()=>{throw new Error("board cannot be null")})(),p=document.getElementById("shuffleButton")??(()=>{throw new Error("shuffleButton cannot be null")})(),T=document.getElementById("deselectButton")??(()=>{throw new Error("deselectButton cannot be null")})(),u=document.getElementById("checkButton")??(()=>{throw new Error("checkButton cannot be null")})(),h=document.getElementById("resetButton"),M=document.getElementById("oneaway")??(()=>{throw new Error("oneaway cannot be null")})(),y=document.getElementById("close-modal"),a=document.getElementById("gameOverModal");p.addEventListener("click",H),T.addEventListener("click",b),u.addEventListener("click",v),h&&h.addEventListener("click",S),a&&y&&y.addEventListener("click",()=>B(a)),a&&a.addEventListener("click",e=>E(e));async function S(){const e="reset/";try{const t=await fetch(e,{headers:{Accept:"text/html"},method:"POST"});if(!t.ok)throw new Error(`Response status: ${t.status}`);const n=await t.text();if(n=="nochange")return;f.innerHTML=n;const o=document.getElementById("gameOverModal");o&&o.removeEventListener("click",r=>E(r)),d.splice(0,d.length),m()}catch(t){i(t,"message")&&console.error(t.message)}}function g(){const e={selected:[]};for(const t of s)e.selected.push({id:parseInt(t.slice(4)),word:t});return e}async function v(){const e="check/";try{const t=g();s.size==4&&(d.push(new Set(s)),u.disabled=!0);const n=await fetch(e,{headers:{Accept:"text/html","Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)});if(!n.ok)throw new Error(`Response status: ${n.status}`);const o=await n.text();if(o=="nochange")return;f.innerHTML=o;const r=document.getElementById("gameOverModal");r&&(r.children[0].children[0].addEventListener("click",()=>B(r)),r.addEventListener("click",L=>E(L)));const c=M.children[0];c.classList.contains("hidden")||setTimeout(()=>{c.classList.add("hidden")},3e3),m()}catch(t){i(t,"message")&&console.error(t.message)}}async function k(){try{const e="shuffle/",t=g(),n=await fetch(e,{headers:{Accept:"text/html","Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)});if(!n.ok)throw new Error(`Response status: ${n.status}`);return await n.text()}catch(e){return i(e,"message")&&console.error(e.message),""}}async function H(){f.innerHTML=await k(),m()}function w(){for(let e=0;e<l.length;e++)s.has(l[e].id)||(l[e].style.cursor="pointer")}async function b(){for(const e of s)(document.getElementById(e)??(()=>{throw new Error(`${e} cannot be null`)})()).classList.remove("selected");s.clear(),w();try{const t=await fetch("deselectAll/",{method:"POST"});if(!t.ok)throw new Error(`Response status: ${t.status}`)}catch(e){i(e,"message")&&console.error(e.message);return}}function x(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function I(e,t){let n=!1;for(let o=0;o<e.length;o++)if(x(e[o],t)){n=!0;break}return n}function P(e){let t;e.target.nodeName=="SPAN"?t=e.target.parentElement:t=e.target;let n=s.has(t.id);u.disabled=!0,n?(t.classList.remove("selected"),s.delete(t.id)):s.size<4&&(t.classList.add("selected"),s.add(t.id));const r=(document.getElementsByClassName("gamestatus")??(()=>{throw new Error("gamestatus cannot be null")})())[0].innerText;if(s.size==4&&!I(d,s)&&r!="loser"&&(u.disabled=!1),s.size==4)for(let c=0;c<l.length;c++)s.has(l[c].id)||(l[c].style.cursor="default");else w()}function B(e){e.style.display="none"}function E(e){a&&e.target===a&&(a.style.display="none")}function m(){for(let t=0;t<l.length;t++)l[t].addEventListener("click",P);const e=document.getElementsByClassName("selected");s.clear();for(let t=0;t<e.length;t++)s.add(e[t].id)}m();
