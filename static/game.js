"use strict";import{isErrorWithProperty as d}from"./common.js";const i=document.getElementsByClassName("word");var E=[],o=new Set,P="";const h=document.getElementById("board")??(()=>{throw new Error("board cannot be null")})(),B=document.getElementById("shuffleButton")??(()=>{throw new Error("shuffleButton cannot be null")})(),w=document.getElementById("deselectButton")??(()=>{throw new Error("deselectButton cannot be null")})(),u=document.getElementById("checkButton")??(()=>{throw new Error("checkButton cannot be null")})(),g=document.getElementById("resetButton"),y=document.getElementById("close-modal"),c=document.getElementById("gameOverModal");B.addEventListener("click",A),w.addEventListener("click",_),u.addEventListener("click",N),g&&g.addEventListener("click",V),c&&y&&y.addEventListener("click",()=>S(c)),c&&c.addEventListener("click",e=>f(e));async function V(){const e="reset/";try{const t=await fetch(e,{headers:{Accept:"text/html"},method:"POST"});if(!t.ok)throw new Error(`Response status: ${t.status}`);const n=await t.text();if(n=="nochange")return;h.innerHTML=n;const l=document.getElementById("gameOverModal");l&&l.removeEventListener("click",s=>f(s)),E.splice(0,E.length),m()}catch(t){d(t,"message")&&console.error(t.message)}}function H(){const e={selected:[],hintsRevealed:r==="revealedinvis"||r==="revealedvis"};for(const t of o)e.selected.push({id:parseInt(t.slice(4)),word:t});return e}async function N(){const e="check/";try{const t=H();o.size==4&&(E.push(new Set(o)),u.disabled=!0);const n=await fetch(e,{headers:{Accept:"text/html","Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)});if(!n.ok)throw new Error(`Response status: ${n.status}`);const l=await n.text();if(l=="nochange")return;h.innerHTML=l;const s=document.getElementById("gameOverModal");s&&(s.children[0].children[0].addEventListener("click",()=>S(s)),s.addEventListener("click",p=>f(p)));const a=document.getElementById("oa")?.children[0];a&&!a.classList.contains("hidden")&&setTimeout(()=>{a.classList.add("hidden")},3e3),m()}catch(t){d(t,"message")&&console.error(t.message)}}async function R(){try{const e="shuffle/",t=H(),n=await fetch(e,{headers:{Accept:"text/html","Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)});if(!n.ok)throw new Error(`Response status: ${n.status}`);return await n.text()}catch(e){return d(e,"message")&&console.error(e.message),""}}async function A(){h.innerHTML=await R(),m()}function T(){for(let e=0;e<i.length;e++)o.has(i[e].id)||(i[e].style.cursor="pointer")}async function _(){for(const e of o)(document.getElementById(e)??(()=>{throw new Error(`${e} cannot be null`)})()).classList.remove("selected");o.clear(),T();try{const t=await fetch("deselectAll/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hintsRevealed:r==="revealedinvis"||r==="revealedvis"})});if(!t.ok)throw new Error(`Response status: ${t.status}`)}catch(e){d(e,"message")&&console.error(e.message);return}}function b(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function k(e,t){let n=!1;for(let l=0;l<e.length;l++)if(b(e[l],t)){n=!0;break}return n}function D(e){let t;e.target.nodeName=="SPAN"?t=e.target.parentElement:t=e.target;let n=o.has(t.id);u.disabled=!0,n?(t.classList.remove("selected"),o.delete(t.id)):o.size<4&&(t.classList.add("selected"),o.add(t.id));const s=(document.getElementsByClassName("gamestatus")??(()=>{throw new Error("gamestatus cannot be null")})())[0].innerText;if(o.size==4&&!k(E,o)&&s!="loser"&&(u.disabled=!1),o.size==4)for(let a=0;a<i.length;a++)o.has(i[a].id)||(i[a].style.cursor="default");else T()}function S(e){e.style.display="none"}function f(e){c&&e.target===c&&(c.style.display="none")}var x=(s=>(s.NOT_REVEALED_INVIS="notrevealedinvis",s.NOT_REVEALED_VIS="notrevealedvis",s.REVEALED_INVIS="revealedinvis",s.REVEALED_VIS="revealedvis",s))(x||{}),r="notrevealedinvis",L=0,v=5;function I(){const e=document.getElementsByClassName("hint-container")[0],t=document.getElementById("reveal-hint"),n=document.getElementById("yellow-hint"),l=document.getElementById("green-hint"),s=document.getElementById("blue-hint"),a=document.getElementById("purple-hint");r==="notrevealedinvis"?(e.classList.add("open"),r="notrevealedvis",L=setInterval(function(){t.innerText=`Hints revealing in... ${--v}`,v<=0&&(t.innerText="Hints:",n.childNodes[0].textContent="\u{1F7E1} ",n.childNodes[1].style="",l.childNodes[0].textContent="\u{1F7E2} ",l.childNodes[1].style="",s.childNodes[0].textContent="\u{1F535} ",s.childNodes[1].style="",a.childNodes[0].textContent="\u{1F7E3} ",a.childNodes[1].style="",r="revealedvis",clearInterval(L))},1e3)):r==="revealedinvis"&&(e.classList.add("open"),r="revealedvis")}function M(){const e=document.getElementsByClassName("hint-container")[0];r==="notrevealedvis"?(e.classList.remove("open"),clearInterval(L),r="notrevealedinvis"):r==="revealedvis"&&(e.classList.remove("open"),r="revealedinvis")}function m(){for(let n=0;n<i.length;n++)i[n].addEventListener("click",D);const e=document.getElementsByClassName("selected");o.clear();for(let n=0;n<e.length;n++)o.add(e[n].id);const t=document.getElementById("hint-icon");t.addEventListener("mousedown",I),t.addEventListener("mouseup",M),t.addEventListener("touchstart",I),t.addEventListener("touchend",M)}m();
