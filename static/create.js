"use strict";import{isErrorWithProperty as O}from"./common.js";var x=(a=>(a.NONE="none",a.YELLOW="yellow",a.GREEN="green",a.BLUE="blue",a.PURPLE="purple",a))(x||{});const A={none:"none",yellow:"yellow",green:"green",blue:"blue",purple:"purple"};function D(){return{yellow:{category:"",words:[],suggestions:[]},green:{category:"",words:[],suggestions:[]},blue:{category:"",words:[],suggestions:[]},purple:{category:"",words:[],suggestions:[]}}}function W(){return{state:"none",categories:D(),gameId:""}}function R(n,e,r){const s={gameId:n,timestamp:e,categories:r};m.push(s),localStorage.setItem("createdGames",JSON.stringify(m))}const q=document.getElementById("yellow-edit")??(()=>{throw new Error("yellowEdit cannot be null")})();q.addEventListener("click",n=>d(n.target));const $=document.getElementById("green-edit")??(()=>{throw new Error("greenEdit cannot be null")})();$.addEventListener("click",n=>d(n.target));const J=document.getElementById("blue-edit")??(()=>{throw new Error("blueEdit cannot be null")})();J.addEventListener("click",n=>d(n.target));const G=document.getElementById("purple-edit")??(()=>{throw new Error("purpleEdit cannot be null")})();G.addEventListener("click",n=>d(n.target));function d(n){const e=n?.parentElement?.parentElement;if(e&&e.classList[1]==t.state)n.src="/static/edit.svg",C(e);else if(e&&t.state=="none")n.src="/static/x.svg",T(e);else{const r=document.getElementById(`${t.state}-edit`),s=r?.parentElement?.parentElement;r&&s&&e&&(r.src="/static/edit.svg",n.src="/static/x.svg",C(s),T(e))}}var c,g,L,y,m,t,f,i=[],l=[];function P(){c=document.getElementById("category-input")??(()=>{throw new Error("categoryInput cannot be null")})(),g=document.getElementById("word-input")??(()=>{throw new Error("wordsInput cannot be null")})(),L=document.getElementById("save-categories-button")??(()=>{throw new Error("saveCategoriesButton cannot be null")})(),y=document.getElementById("submit")??(()=>{throw new Error("submitButton cannot be null")})(),f=document.getElementById("suggestionsSettings")?.textContent?.trim()==="true";let n=localStorage.getItem("ctx");n?(t=JSON.parse(n),t.state!=="none"&&(t.state="none",localStorage.setItem("ctx",JSON.stringify(t))),t.categories.yellow?.suggestions?.length||(t.categories.yellow.suggestions=new Array),t.categories.green?.suggestions?.length||(t.categories.green.suggestions=new Array),t.categories.blue?.suggestions?.length||(t.categories.blue.suggestions=new Array),t.categories.purple?.suggestions?.length||(t.categories.purple.suggestions=new Array)):(t=W(),localStorage.setItem("ctx",JSON.stringify(t))),m=JSON.parse(localStorage.getItem("createdGames")??"[]"),m||localStorage.setItem("createdGames",JSON.stringify(m)),E(),document.getElementById("category-input")?.addEventListener("keyup",function(){k()?c.classList.remove("toolong"):c.classList.contains("toolong")||c.classList.add("toolong")}),document.getElementById("category-input")?.addEventListener("keydown",function(e){const r=this;if(e.key===","||e.key==="Enter"){if(e.preventDefault(),!k())return;const s=r.value.trim();s&&l.length<1&&(B(s,r,!0),f&&j(s,!0),r.value="")}else if((e.key==="Backspace"||e.key==="Delete")&&!r.value.trim()){const o=l.pop();S(o?.children[0],!0),e.preventDefault()}}),document.getElementById("word-input")?.addEventListener("keyup",function(){this.value.trim().length>N?g.classList.contains("toolong")||g.classList.add("toolong"):g.classList.remove("toolong")}),document.getElementById("word-input")?.addEventListener("keydown",function(e){const r=this,s=r.value.trim();if(e.key===","||e.key==="Enter"){if(e.preventDefault(),!X())return;s&&i.length<4&&(h(s,r,!0),r.value="")}else if((e.key==="Backspace"||e.key==="Delete")&&!s){const o=i.pop();o&&o.hasChildNodes()&&(v(o.children[0],!1,!0),e.preventDefault())}}),document.addEventListener("keydown",function(e){t.state!="none"||document.getElementById("gameId-input")==document.activeElement||(e.key==="Y"||e.key==="y"?(t.state=="none"&&document.querySelector("div.colors-item.yellow")?.querySelector("img")?.click(),e.preventDefault()):e.key==="G"||e.key==="g"?(t.state=="none"&&document.querySelector("div.colors-item.green")?.querySelector("img")?.click(),e.preventDefault()):e.key==="B"||e.key==="b"?(t.state=="none"&&document.querySelector("div.colors-item.blue")?.querySelector("img")?.click(),e.preventDefault()):(e.key==="P"||e.key==="p")&&(t.state=="none"&&document.querySelector("div.colors-item.purple")?.querySelector("img")?.click(),e.preventDefault()))},!0),H();for(const e in t.categories){const r=document.getElementById(`category-${e}`),s=document.getElementById(`words-${e}`),o=r?.parentElement?.parentElement,a=o?.querySelector("img");r&&o&&a&&r.addEventListener("click",()=>d(a)),s&&o&&a&&s.addEventListener("click",()=>d(a))}}P();function I(){const n=document.getElementById("suggestions");n.innerHTML="Suggestions:",n.classList.add("void")}function p(n){const e=document.getElementById("suggestions");let r=Array();t.state!="none"&&(r=t.categories[t.state].words);for(let s=0;s<n.length;++s){const o=document.createElement("div");o.textContent=n[s],o.setAttribute("id",`sugg-${s}`),s<6?o.setAttribute("class","suggestion uppercase"):o.setAttribute("class","suggestion uppercase void"),r.includes(n[s].toUpperCase())&&o.classList.add("disabled"),o.addEventListener("click",()=>{o.classList.contains("disabled")||(h(n[s],document.getElementById("word-input"),!0),o.classList.add("disabled"))}),e.appendChild(o)}e.classList.remove("void")}async function j(n,e=!1){if(t.state==="none")return;if(t.categories[t.state].suggestions.length&&!e){p(t.categories[t.state].suggestions);return}e&&I();let r=`Topic
\`\`\`
${n}
\`\`\``;const s=await fetch("/create/suggestions/",{headers:{Accept:"application/json","Content-Type":"text/plain"},method:"POST",body:JSON.stringify(r)});if(!s.ok)throw new Error(`Response status: ${s.status}`);const o=await s.json();p(o),t.categories[t.state].suggestions=o,localStorage.setItem("ctx",JSON.stringify(t))}function E(){for(const n in t.categories){const e=document.getElementById(`category-${n}`),r=document.getElementById(`words-${n}`);let s="tbd";if(t.categories.hasOwnProperty(n)){const o=n;t.categories[o].category!=""&&(s=`<span class="category category2">${t.categories[o].category}</span>`),e&&(e.innerHTML=s);let a="tbd";const u=t.categories[o].words.length;if(u>0){a="";for(let w=0;w<u;w++)a+=`<span class="category category2">${t.categories[o].words[w]}</span>`}r&&(r.innerHTML=a)}}}function T(n){if(t.state==="none"){let e=n.classList[1];t.state=A[e],n.classList.add("color-selected"),c&&(c.disabled=!1),g.disabled=!1,L.disabled=!1,U(),t.state!=="none"&&f&&p(t.categories[t.state].suggestions),l.length>0?g.focus():c.focus()}}function C(n){t.state="none",n.classList.remove("color-selected"),c.disabled=!0,g.disabled=!0,L.disabled=!0,M(),I()}function U(){const n=t.state.toString();if(n==="yellow"||n==="green"||n==="blue"||n==="purple"){const e=t.categories[n];e.category!=""&&B(e.category,c);for(let r=0;r<e.words.length;r++)h(e.words[r],g)}}function M(){for(let n=0;n<l.length;n++)S(l[n].children[0]);for(let n=0;n<i.length;n++)v(i[n].children[0],!1);l.splice(0,l.length),i.splice(0,i.length),c.value="",g.value=""}function H(){t.categories.yellow.words.length==4&&t.categories.green.words.length==4&&t.categories.blue.words.length==4&&t.categories.purple.words.length==4?y.disabled=!1:y.disabled=!0}const Y=document.getElementById("save-categories-button")??(()=>{throw new Error("saveCategories cannot be null")})();Y.addEventListener("click",()=>_());function _(){if(t.state!="none"){let n=l.length>0?l[0].innerText:"";t.categories[t.state].category=n.slice(0,n.indexOf(`
`)),t.categories[t.state].words.splice(0,t.categories[t.state].words.length);for(let s=0;s<i.length;s++){let o=i[s].innerText;t.categories[t.state].words.push(o.slice(0,o.indexOf(`
`)))}const e=document.getElementById("gameId-input");t.gameId=e!=null?e.value.trim().replace(/\s+/g,"-"):"",M();const r=document.querySelector(`div.colors-item.${t.state}`);if(r){const s=r.querySelector("img");s.src="/static/edit.svg",C(r)}localStorage.setItem("ctx",JSON.stringify(t)),E(),H()}}function b(n){if(n==="none")return;const e=t.categories[n];let r=l.length>0?l[0].innerText:"";e.category=r.slice(0,r.indexOf(`
`)),e.words.splice(0,e.words.length);for(let s=0;s<i.length;s++){let o=i[s].innerText;e.words.push(o.slice(0,o.indexOf(`
`)))}localStorage.setItem("ctx",JSON.stringify(t)),E()}const V=document.getElementById("submit-warning-close")??(()=>{throw new Error("submitWarningClose cannot be null")})();V.addEventListener("click",n=>F(n.target));function F(n){const e=n.parentElement;e&&(e.style.visibility="hidden")}function K(){let n=[];const e=t.categories,r=e.yellow,s=e.green,o=e.blue,a=e.purple;return r.category&&n.push(r.category),s.category&&n.push(s.category),o.category&&n.push(o.category),a.category&&n.push(a.category),n}const z=document.getElementById("submit")??(()=>{throw new Error("submit cannot be null")})();z.addEventListener("click",()=>Q());async function Q(){const n="";try{const e={yellow:t.categories.yellow,green:t.categories.green,blue:t.categories.blue,purple:t.categories.purple,gameId:t.gameId??""},r=await fetch(n,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(e)});if(!r.ok)throw new Error(`Response status: ${r.status}`);const s=await r.json();if(s.success===!1){const o=document.getElementById("warning-message");o&&(o.innerText=s.failureReason,o.parentElement&&(o.parentElement.style.visibility="visible")),y.disabled=!0}else if(s.gameId&&s.gameId!=""){localStorage.removeItem("ctx"),R(s.gameId,Date.now(),K()),window.location.href=`/game/${s.gameId}/`;return}}catch(e){O(e,"message")&&console.error(e.message)}}const N=20;function X(){return!(g.value.length>N)}function h(n,e,r=!1){const s=document.querySelector(".word-container"),o=document.createElement("div");o.className="category";const a=document.createElement("span");a.classList.add("word-remove"),a.innerHTML="&times;",a.addEventListener("click",u=>v(u.target,!0,!0)),o.innerHTML=n,o.appendChild(a),s&&s.insertBefore(o,e),i.push(o),r&&b(t.state)}function v(n,e=!0,r=!1){if(e){let s=i.indexOf(n.parentElement);i.splice(s,1)}n?.parentElement?.remove(),g.focus(),r&&b(t.state),t.state!=="none"&&f&&(I(),p(t.categories[t.state].suggestions))}const Z=40;function k(){return!(c.value.length>Z)}function B(n,e,r=!1){const s=document.querySelector(".category-container")??(()=>{throw new Error("category-container cannot be null")})(),o=document.createElement("div");o.className="category";const a=document.createElement("span");a.classList.add("word-remove"),a.innerHTML="&times;",a.addEventListener("click",u=>S(u.target,!0)),o.innerHTML=n,o.appendChild(a),s.insertBefore(o,e),l.push(o),r&&b(t.state)}function S(n,e=!1){n.parentElement?.remove(),c.focus(),l.splice(0,1),e&&t.state!=="none"&&(t.categories[t.state].category="",localStorage.setItem("ctx",JSON.stringify(t)),E())}
